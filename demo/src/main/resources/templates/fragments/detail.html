<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title layout:fragment="title" th:text="${news.title + ' - NewsHub'}">News Detail - NewsHub</title>

    <!-- SEO Meta Tags -->
    <meta name="description" th:content="${news.description ?: #strings.abbreviate(news.content, 160)}">
    <meta name="keywords" th:content="${news.category.name + ', news, ' + (news.author ?: '')}">
    <meta name="author" th:content="${news.author ?: 'NewsHub Editorial Team'}">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" th:content="${news.title}">
    <meta property="og:description" th:content="${news.description ?: #strings.abbreviate(news.content, 200)}">
    <meta property="og:image" th:content="${news.imageUrl ?: '/images/og-default.jpg'}">
    <meta property="og:type" content="article">
    <meta property="article:published_time" th:content="${news.publishedAt}">
    <meta property="article:modified_time" th:content="${news.updatedAt}">
    <meta property="article:author" th:content="${news.author}">
    <meta property="article:section" th:content="${news.category.name}">
</head>

<body>
<div layout:fragment="content">
    <!-- Breadcrumb -->
    <section class="breadcrumb-section py-3 bg-light">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item">
                        <a href="/" class="text-decoration-none">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="breadcrumb-item">
                        <a th:href="@{/category/{slug}(slug=${news.category.slug})}"
                           class="text-decoration-none" th:text="${news.category.name}">Category</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page" th:text="${#strings.abbreviate(news.title, 50)}">Article Title</li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Article Content -->
    <article class="article-detail-section py-5">
        <div class="container">
            <div class="row">
                <!-- Main Article Content -->
                <div class="col-lg-8 col-xl-9">
                    <div class="article-content">
                        <!-- Article Header -->
                        <header class="article-header mb-4">
                            <!-- Category Badge -->
                            <div class="article-meta mb-3">
                                <span class="badge bg-primary me-2" th:text="${news.category.name}">Category</span>
                                <span class="badge bg-success" th:if="${news.isFeatured}">Featured</span>
                                <span class="badge bg-warning text-dark ms-1" th:if="${news.isTrending}">
                                        <i class="fas fa-fire me-1"></i>Trending
                                    </span>
                            </div>

                            <!-- Article Title -->
                            <h1 class="article-title display-5 fw-bold mb-3" th:text="${news.title}">
                                Article Title Here
                            </h1>

                            <!-- Article Description -->
                            <p class="article-description lead text-muted mb-4" th:if="${news.description}"
                               th:text="${news.description}">
                                Article description and summary goes here...
                            </p>

                            <!-- Article Meta Information -->
                            <div class="article-info d-flex flex-wrap align-items-center justify-content-between border-bottom pb-3 mb-4">
                                <div class="author-info d-flex align-items-center">
                                    <div class="author-avatar me-3">
                                        <i class="fas fa-user-circle fa-2x text-muted"></i>
                                    </div>
                                    <div>
                                        <div class="author-name fw-semibold" th:text="${news.author ?: 'NewsHub Staff'}">Author Name</div>
                                        <small class="text-muted">
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            <time th:datetime="${news.publishedAt}" th:text="${#temporals.format(news.publishedAt, 'MMMM dd, yyyy')}">Date</time>
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-clock me-1"></i>
                                            <span>5 min read</span>
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-eye me-1"></i>
                                            <span th:text="${#numbers.formatInteger(news.viewCount, 0, 'COMMA')}">0</span> views
                                        </small>
                                    </div>
                                </div>

                                <!-- Social Share Buttons -->
                                <div class="share-buttons d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-primary share-btn"
                                            data-platform="facebook"
                                            th:attr="data-url=@{/news/{id}(id=${news.id})}, data-title=${news.title}"
                                            title="Share on Facebook">
                                        <i class="fab fa-facebook-f"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info share-btn"
                                            data-platform="twitter"
                                            th:attr="data-url=@{/news/{id}(id=${news.id})}, data-title=${news.title}"
                                            title="Share on Twitter">
                                        <i class="fab fa-twitter"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary share-btn"
                                            data-platform="linkedin"
                                            th:attr="data-url=@{/news/{id}(id=${news.id})}, data-title=${news.title}"
                                            title="Share on LinkedIn">
                                        <i class="fab fa-linkedin-in"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success share-btn"
                                            data-platform="whatsapp"
                                            th:attr="data-url=@{/news/{id}(id=${news.id})}, data-title=${news.title}"
                                            title="Share on WhatsApp">
                                        <i class="fab fa-whatsapp"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary share-btn"
                                            data-platform="copy"
                                            th:attr="data-url=@{/news/{id}(id=${news.id})}"
                                            title="Copy Link">
                                        <i class="fas fa-link"></i>
                                    </button>
                                </div>
                            </div>
                        </header>

                        <!-- Featured Image -->
                        <div class="article-image mb-4" th:if="${news.imageUrl}">
                            <figure class="figure w-100">
                                <img th:src="${news.imageUrl}"
                                     th:alt="${news.title}"
                                     class="figure-img img-fluid rounded shadow-sm w-100"
                                     loading="eager">
                                <figcaption class="figure-caption text-muted mt-2" th:if="${news.source}">
                                    <i class="fas fa-camera me-1"></i>
                                    Image source: <span th:text="${news.source.name}">Source</span>
                                </figcaption>
                            </figure>
                        </div>

                        <!-- Article Body -->
                        <div class="article-body">
                            <div class="article-text" th:utext="${#strings.replace(news.content, T(java.lang.System).lineSeparator(), '<br>')}">
                                <p>Article content goes here. This would be the full content of the news article with proper formatting, paragraphs, and any embedded media.</p>

                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
                            </div>
                        </div>

                        <!-- Article Footer -->
                        <footer class="article-footer mt-5 pt-4 border-top">
                            <!-- Tags -->
                            <div class="article-tags mb-4" th:if="${news.category}">
                                <h6 class="mb-2">Related Topics:</h6>
                                <a th:href="@{/category/{slug}(slug=${news.category.slug})}"
                                   class="badge bg-light text-dark text-decoration-none me-2 mb-2 p-2"
                                   th:text="${news.category.name}">Tag</a>
                                <!-- Add more tags if available -->
                            </div>

                            <!-- Source Information -->
                            <div class="source-info mb-4" th:if="${news.source}">
                                <h6 class="mb-2">Source:</h6>
                                <div class="d-flex align-items-center">
                                    <img th:if="${news.source.logoUrl}"
                                         th:src="${news.source.logoUrl}"
                                         th:alt="${news.source.name}"
                                         class="me-2" style="height: 24px;">
                                    <span th:text="${news.source.name}" class="fw-semibold">Source Name</span>
                                    <a th:if="${news.sourceUrl}"
                                       th:href="${news.sourceUrl}"
                                       class="btn btn-sm btn-outline-primary ms-2"
                                       target="_blank" rel="noopener">
                                        <i class="fas fa-external-link-alt me-1"></i>Original Article
                                    </a>
                                </div>
                            </div>

                            <!-- Article Stats -->
                            <div class="article-stats d-flex justify-content-between align-items-center p-3 bg-light rounded">
                                <div class="stats-item">
                                    <i class="fas fa-eye text-primary me-2"></i>
                                    <span th:text="${#numbers.formatInteger(news.viewCount, 0, 'COMMA')}">0</span> Views
                                </div>
                                <div class="stats-item">
                                    <i class="fas fa-calendar text-success me-2"></i>
                                    Published: <span th:text="${#temporals.format(news.publishedAt, 'MMM dd, yyyy')}">Date</span>
                                </div>
                                <div class="stats-item" th:if="${news.updatedAt != news.createdAt}">
                                    <i class="fas fa-edit text-warning me-2"></i>
                                    Updated: <span th:text="${#temporals.format(news.updatedAt, 'MMM dd, yyyy')}">Date</span>
                                </div>
                            </div>
                        </footer>
                    </div>
                </div>

                <!-- Sidebar -->
                <aside class="col-lg-4 col-xl-3">
                    <div class="sidebar-content">
                        <!-- Related Articles -->
                        <div class="related-articles-widget mb-4" th:if="${relatedNews != null and !relatedNews.empty}">
                            <h5 class="widget-title mb-3">
                                <i class="fas fa-newspaper me-2"></i>Related Articles
                            </h5>
                            <div class="related-articles-list">
                                <article class="related-article mb-3" th:each="related : ${relatedNews}">
                                    <div class="row g-2">
                                        <div class="col-4">
                                            <a th:href="@{/news/{id}(id=${related.id})}">
                                                <img th:src="${related.imageUrl ?: '/images/placeholder/news-default.jpg'}"
                                                     th:alt="${related.title}"
                                                     class="img-fluid rounded">
                                            </a>
                                        </div>
                                        <div class="col-8">
                                            <h6 class="article-title mb-1">
                                                <a th:href="@{/news/{id}(id=${related.id})}"
                                                   class="text-decoration-none text-dark hover-primary"
                                                   th:text="${#strings.abbreviate(related.title, 60)}">Related Article Title</a>
                                            </h6>
                                            <small class="text-muted">
                                                <i class="fas fa-clock me-1"></i>
                                                <span th:text="${#temporals.format(related.publishedAt, 'MMM dd')}">Date</span>
                                            </small>
                                        </div>
                                    </div>
                                </article>
                            </div>
                        </div>

                        <!-- Category Widget -->
                        <div class="category-widget mb-4" th:if="${categories != null and !categories.empty}">
                            <h5 class="widget-title mb-3">
                                <i class="fas fa-folder me-2"></i>Categories
                            </h5>
                            <div class="category-list">
                                <a th:each="category : ${categories}"
                                   th:href="@{/category/{slug}(slug=${category.slug})}"
                                   class="category-link d-flex justify-content-between align-items-center p-2 mb-2 text-decoration-none rounded hover-bg-light"
                                   th:classappend="${category.id == news.category.id} ? 'bg-primary text-white' : 'text-dark'">
                                        <span>
                                            <i th:class="${category.iconClass ?: 'fas fa-folder'}" class="me-2"></i>
                                            <span th:text="${category.name}">Category</span>
                                        </span>
                                    <span class="badge"
                                          th:classappend="${category.id == news.category.id} ? 'bg-white text-primary' : 'bg-light text-dark'">
                                            <span th:text="${category.newsList?.size() ?: 0}">0</span>
                                        </span>
                                </a>
                            </div>
                        </div>

                        <!-- Popular Articles Widget -->
                        <div class="popular-widget mb-4">
                            <h5 class="widget-title mb-3">
                                <i class="fas fa-fire me-2"></i>Popular Articles
                            </h5>
                            <div class="popular-articles">
                                <!-- These would come from a service method -->
                                <div class="popular-item d-flex mb-3">
                                    <div class="popular-rank me-3">
                                        <span class="badge bg-primary rounded-circle">1</span>
                                    </div>
                                    <div class="popular-content">
                                        <h6 class="mb-1">
                                            <a href="#" class="text-decoration-none text-dark hover-primary">
                                                Popular Article Title Goes Here
                                            </a>
                                        </h6>
                                        <small class="text-muted">
                                            <i class="fas fa-eye me-1"></i>2.5K views
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Newsletter Signup Widget -->
                        <div class="newsletter-widget p-4 bg-primary text-white rounded mb-4">
                            <h5 class="widget-title text-white mb-3">
                                <i class="fas fa-envelope me-2"></i>Stay Updated
                            </h5>
                            <p class="mb-3">Get the latest news delivered directly to your inbox.</p>
                            <form class="newsletter-form">
                                <div class="mb-3">
                                    <input type="email" class="form-control" placeholder="Your email address" required>
                                </div>
                                <button type="submit" class="btn btn-light w-100">
                                    <i class="fas fa-paper-plane me-2"></i>Subscribe
                                </button>
                            </form>
                        </div>

                        <!-- Advertisement Space -->
                        <div class="ad-widget mb-4">
                            <div class="ad-placeholder bg-light text-center p-4 rounded">
                                <i class="fas fa-ad fa-2x text-muted mb-2"></i>
                                <p class="text-muted mb-0">Advertisement</p>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </article>

    <!-- Comments Section (Optional) -->
    <section class="comments-section py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-xl-9">
                    <div class="comments-wrapper">
                        <h4 class="mb-4">
                            <i class="fas fa-comments me-2"></i>Comments (0)
                        </h4>

                        <!-- Comment Form -->
                        <div class="comment-form mb-4">
                            <form class="bg-white p-4 rounded shadow-sm">
                                <h5 class="mb-3">Leave a Comment</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <input type="text" class="form-control" placeholder="Your Name" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="email" class="form-control" placeholder="Your Email" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <textarea class="form-control" rows="4" placeholder="Your Comment" required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane me-2"></i>Post Comment
                                </button>
                            </form>
                        </div>

                        <!-- Comments List -->
                        <div class="comments-list">
                            <div class="no-comments text-center py-5">
                                <i class="fas fa-comment-slash fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">No comments yet</h5>
                                <p class="text-muted">Be the first to share your thoughts!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- You Might Also Like Section -->
    <section class="related-news-section py-5" th:if="${relatedNews != null and !relatedNews.empty}">
        <div class="container">
            <div class="row mb-4">
                <div class="col-12">
                    <h3 class="section-title text-center mb-0">
                        <i class="fas fa-thumbs-up me-2"></i>You Might Also Like
                    </h3>
                    <div class="title-divider mx-auto mt-2"></div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-lg-3 col-md-6" th:each="related : ${relatedNews}">
                    <article class="related-news-card">
                        <div class="card h-100 shadow-sm hover-lift">
                            <div class="card-img-wrapper position-relative">
                                <img th:src="${related.imageUrl ?: '/images/placeholder/news-default.jpg'}"
                                     class="card-img-top" th:alt="${related.title}" loading="lazy">
                                <div class="card-overlay">
                                        <span class="badge bg-primary position-absolute top-0 start-0 m-2"
                                              th:text="${related.category.name}">Category</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">
                                    <a th:href="@{/news/{id}(id=${related.id})}"
                                       class="text-decoration-none text-dark hover-primary"
                                       th:text="${related.title}">Related News Title</a>
                                </h5>
                                <p class="card-text text-muted small"
                                   th:text="${#strings.abbreviate(related.description ?: related.content, 100)}">
                                    Brief description...
                                </p>
                                <div class="card-meta d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        <span th:text="${#temporals.format(related.publishedAt, 'MMM dd')}">Date</span>
                                    </small>
                                    <small class="text-muted">
                                        <i class="fas fa-eye me-1"></i>
                                        <span th:text="${related.viewCount}">0</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Page Specific CSS -->
<th:block layout:fragment="page-css">
    <style>
        .article-detail-section {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        }

        .article-title {
            color: #1e293b;
            line-height: 1.2;
        }

        .article-description {
            font-size: 1.125rem;
            color: #64748b;
        }

        .article-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #374151;
        }

        .article-text p {
            margin-bottom: 1.5rem;
        }

        .article-text h2, .article-text h3, .article-text h4 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #1e293b;
        }

        .share-buttons .btn {
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .share-buttons .btn:hover {
            transform: translateY(-2px);
        }

        .widget-title {
            font-weight: 600;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .related-article:hover {
            background-color: #f8fafc;
            border-radius: 0.5rem;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .category-link:hover {
            transform: translateX(5px);
            transition: all 0.3s ease;
        }

        .hover-bg-light:hover {
            background-color: #f8fafc !important;
        }

        .popular-rank .badge {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .comments-section {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }

        .card-img-wrapper {
            height: 200px;
            overflow: hidden;
        }

        .card-img-wrapper img {
            transition: transform 0.3s ease;
        }

        .card:hover .card-img-wrapper img {
            transform: scale(1.05);
        }

        .card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.5) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover .card-overlay {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .article-title {
                font-size: 1.75rem;
            }

            .article-description {
                font-size: 1rem;
            }

            .share-buttons {
                justify-content: center;
                margin-top: 1rem;
            }

            .article-info {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .sidebar-content {
                margin-top: 2rem;
            }
        }
    </style>
</th:block>

<!-- Page Specific JavaScript -->
<th:block layout:fragment="page-scripts">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize social sharing
            initSocialSharing();

            // Initialize reading progress
            initReadingProgress();

            // Initialize image lazy loading
            initImageLazyLoading();
        });

        function initSocialSharing() {
            const shareButtons = document.querySelectorAll('.share-btn');
            shareButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const platform = this.getAttribute('data-platform');
                    const url = encodeURIComponent(window.location.href);
                    const title = encodeURIComponent(this.getAttribute('data-title') || document.title);

                    let shareUrl;
                    switch(platform) {
                        case 'facebook':
                            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                            break;
                        case 'twitter':
                            shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
                            break;
                        case 'linkedin':
                            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
                            break;
                        case 'whatsapp':
                            shareUrl = `https://wa.me/?text=${title}%20${url}`;
                            break;
                        case 'copy':
                            navigator.clipboard.writeText(window.location.href).then(() => {
                                showNotification('Link copied to clipboard!', 'success');
                            });
                            return;
                    }

                    if (shareUrl) {
                        window.open(shareUrl, '_blank', 'width=600,height=400');
                    }
                });
            });
        }

        function initReadingProgress() {
            // Create reading progress bar
            const progressBar = document.createElement('div');
            progressBar.className = 'reading-progress';
            progressBar.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 0%;
                height: 3px;
                background: linear-gradient(90deg, #3b82f6, #06b6d4);
                z-index: 1000;
                transition: width 0.1s ease;
            `;
            document.body.appendChild(progressBar);

            // Update progress on scroll
            window.addEventListener('scroll', function() {
                const article = document.querySelector('.article-content');
                if (article) {
                    const articleTop = article.offsetTop;
                    const articleHeight = article.offsetHeight;
                    const windowHeight = window.innerHeight;
                    const scrollTop = window.scrollY;

                    const progress = Math.min(100, Math.max(0,
                        ((scrollTop - articleTop + windowHeight) / articleHeight) * 100
                    ));

                    progressBar.style.width = progress + '%';
                }
            });
        }

        function initImageLazyLoading() {
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.classList.add('fade-in');
                            imageObserver.unobserve(img);
                        }
                    });
                });

                document.querySelectorAll('img[loading="lazy"]').forEach(img => {
                    imageObserver.observe(img);
                });
            }
        }

        function showNotification(message, type) {
            // This function should be available from main.js
            if (typeof window.NewsUtils !== 'undefined' && window.NewsUtils.showNotification) {
                window.NewsUtils.showNotification(message, type);
            }
        }
    </script>
</th:block>

<!-- Structured Data for News Article -->
<script type="application/ld+json" layout:fragment="structured-data">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "headline": "[[${news.title}]]",
        "description": "[[${news.description ?: #strings.abbreviate(news.content, 200)}]]",
        "image": "[[${news.imageUrl}]]",
        "author": {
            "@type": "Person",
            "name": "[[${news.author ?: 'NewsHub Editorial Team'}]]"
        },
        "publisher": {
            "@type": "Organization",
            "name": "NewsHub",
            "logo": {
                "@type": "ImageObject",
                "url": "https://yournewssite.com/images/logo.png"
            }
        },
        "datePublished": "[[${news.publishedAt}]]",
        "dateModified": "[[${news.updatedAt}]]",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "[[${pageUrl}]]"
        },
        "articleSection": "[[${news.category.name}]]",
        "wordCount": "[[${#strings.length(news.content)}]]"
    }
</script>
</body>
</html>